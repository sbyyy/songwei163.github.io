<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.2">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.2" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="古渡廊桥">
<meta property="og:url" content="https://songwei163.github.io/index.html">
<meta property="og:site_name" content="古渡廊桥">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="古渡廊桥">





  
  
  <link rel="canonical" href="https://songwei163.github.io/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>古渡廊桥</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">古渡廊桥</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">风里雨里</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Navigationsleiste an/ausschalten">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Startseite</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Schlagwörter</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Kategorien</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archiv</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://songwei163.github.io/2019/06/08/线程同步机制（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宋伟">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古渡廊桥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/08/线程同步机制（一）/" class="post-title-link" itemprop="url">Unbenannt</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-06-08 23:53:10 / Geändert am: 23:58:59" itemprop="dateCreated datePublished" datetime="2019-06-08T23:53:10+08:00">2019-06-08</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="线程同步机制（一）"><a href="#线程同步机制（一）" class="headerlink" title="线程同步机制（一）"></a>线程同步机制（一）</h4><ul>
<li>资源竞争</li>
<li>互斥</li>
<li>死锁</li>
<li>信号量</li>
<li>条件变量</li>
</ul>
<h5 id="资源竞争"><a href="#资源竞争" class="headerlink" title="资源竞争"></a>资源竞争</h5><p>存在一个任务队列，多个并发线程同时处理这些任务。每个线程在完成某项任务后，检查任务队列中是否有新任务。如果有就处理该任务，并将该任务从任务队列中删除</p>
<p>假设：两个线程碰巧完成各自任务，但队列中只有一个任务。</p>
<p>可能发生的情况：第一个线程发现任务队列非空，准备接收该任务，但没有完成全部设置。此时，操作系统碰巧中断该线程。第二个线程获得了执行权，也发现任务队列非空，同样准备接收该任务，但发现已经无法正确设置任务队列。</p>
<p>最坏情况：第一个线程已经从任务队列中摘取了任务，但是还没有将任务队列设置为空，第二个线程对任务队列的访问导致段错误，系统崩溃。</p>
<h5 id="互斥"><a href="#互斥" class="headerlink" title="互斥"></a>互斥</h5><p>互斥（mutex）定义与性质：mutial  exclusion</p>
<ul>
<li>相互独占锁，与二元信号量类似</li>
<li>一次只有一个线程可以锁定一个数据对象，并访问</li>
<li>只有该线程释放锁定，其他线程才能访问该数据对象</li>
</ul>
<p><code>pthread_mutex_init()</code>函数：初始化互斥</p>
<ul>
<li><p>原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_mutex_init</span><span class="params">(<span class="keyword">pthread_mutex_t</span>  *mutex,  <span class="keyword">const</span>  <span class="keyword">pthread_mutex_attr_t</span> *mutexattr)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数：<code>mutex</code>为互斥对象，<code>mutexattr</code>为互斥属性对象，<code>NULL</code>表示使用缺省属性</p>
</li>
<li><p>可使用预定义宏<code>PTHREAD_MUTEX_INITIALIZER</code>初始化互斥</p>
</li>
</ul>
<p><code>pthread_mutex_destroy()</code>函数：销毁互斥</p>
<ul>
<li><p>原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_mutex_destroy</span><span class="params">(<span class="keyword">pthread_mutex_t</span> *mutex)</span></span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><code>pthread_mutex_lock()</code>函数：互斥加锁</p>
<ul>
<li><p>原型：    </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_mutex_lock</span><span class="params">(<span class="keyword">pthread_mutex_t</span> *mutex)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果无法锁定，则调用阻塞，至该互斥被解除锁定状态</p>
</li>
</ul>
<p><code>pthread_mutex_trylock()</code>函数：互斥加锁</p>
<ul>
<li><p>原型：        </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_mutex_trylock</span><span class="params">(<span class="keyword">pthread_mutex_t</span> *mutex)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果无法锁定，则立即返回，不阻塞</p>
</li>
</ul>
<p><code>pthread_mutex_unlock()</code>函数：互斥解锁</p>
<ul>
<li><p>原型 ：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_mutex_unlock</span><span class="params">(<span class="keyword">pthread_mutex_t</span> *mutex)</span></span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h6 id="使用互斥的流程"><a href="#使用互斥的流程" class="headerlink" title="使用互斥的流程"></a>使用互斥的流程</h6><ul>
<li>定义<code>pthread_mutex_t</code>类型的变量，将其地址作为第一个参数传给<code>pthread_mutex_init()</code>函数；初始化函数只需调用一次</li>
<li>锁定或尝试锁定该互斥；获得访问权后，执行正常程序代码；并在执行完毕后解锁</li>
</ul>
<h6 id="互斥属性"><a href="#互斥属性" class="headerlink" title="互斥属性"></a>互斥属性</h6><ul>
<li><p><code>pshared</code>属性：进程共享属性</p>
<p>取值：</p>
<p>​    <code>PTHREAD_PROCESS_SHARED</code>（跨进程共享）</p>
<p>​    <code>PTHREAD_PROCESS_PRIVATE</code>（本进程内部共享）</p>
</li>
<li><p><code>type</code>属性：互斥类型</p>
<p><code>PTHREAD_MUTEX_NORMAL</code>：普通锁</p>
<ul>
<li>被某个线程锁定后，其他请求加锁的进程将等待</li>
<li>容易导致死锁</li>
<li>解锁被其他线程锁定或已解锁的互斥，将导致不可预期的后果</li>
</ul>
<p><code>PTHREAD_MUTEX_ERRORCHEACK</code>：检错锁</p>
<ul>
<li>线程对已被其他线程锁定的互斥加锁，将返回EDEADLK</li>
</ul>
<p><code>PTHREAD_MUTEX_RECURSIVE</code>:递归锁*</p>
<ul>
<li>允许线程对互斥多次加锁；解锁次数必须与加锁次数匹配</li>
</ul>
<p><code>PTHREAD_MUTEX_DEFAULT</code>：默认锁</p>
<ul>
<li>实现上可能为上述三种之一</li>
</ul>
</li>
</ul>
<h6 id="互斥属性函数"><a href="#互斥属性函数" class="headerlink" title="互斥属性函数"></a>互斥属性函数</h6>  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_mutexattr_init</span><span class="params">(<span class="keyword">pthread_mutexattr_t</span> *attr)</span></span>;	<span class="comment">/*初始化互斥属性对象*/</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_mutexattr_destroy</span><span class="params">(<span class="keyword">pthread_mutexattr_t</span> *attr)</span></span>;	<span class="comment">/*销毁互斥属性对象*/</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_mutexattr_settype</span><span class="params">(<span class="keyword">pthread_mutexattr_t</span> *attr, <span class="keyword">int</span> kind)</span></span>;	<span class="comment">/*设置typed属性*/</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_mutexattr_gettype</span><span class="params">(<span class="keyword">const</span>  <span class="keyword">pthread_mutexattr_t</span>  *attr, <span class="keyword">int</span> *kind)</span></span>; <span class="comment">/*获取type属性*/</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_mutexattr_getpshared</span><span class="params">(<span class="keyword">const</span> <span class="keyword">pthread_mutexattr_t</span>*attr, <span class="keyword">int</span> *pshared)</span></span>;<span class="comment">/*获取pshared属性*/</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_mutexattr_setpshared</span><span class="params">(<span class="keyword">pthread_mutexattr_t</span> *attr,<span class="keyword">int</span> pshared)</span></span>;	<span class="comment">/*获取pshared属性*/</span></span><br></pre></td></tr></table></figure>



<h6 id="互斥程序例子"><a href="#互斥程序例子" class="headerlink" title="互斥程序例子"></a>互斥程序例子</h6>  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Job</span> &#123;</span></span><br><span class="line">  Job (<span class="keyword">int</span> x = <span class="number">0</span>, <span class="keyword">int</span> y = <span class="number">0</span>)</span><br><span class="line">      : x (x), y (y)</span><br><span class="line">  &#123; &#125;</span><br><span class="line">  <span class="keyword">int</span> x, y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>&lt;Job *&gt; job_queue;</span><br><span class="line"><span class="keyword">pthread_mutex_t</span> job_queue_mutex = PTHREAD_MUTEX_INITIALIZER;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ProcessJob</span> <span class="params">(Job *job)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"Thread "</span> &lt;&lt; (<span class="keyword">int</span>) pthread_self ();</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"processing ("</span> &lt;&lt; job-&gt;x &lt;&lt; <span class="string">","</span> &lt;&lt; job-&gt;y &lt;&lt; <span class="string">")\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理作业时需要加锁</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">DequeueJob</span> <span class="params">(<span class="keyword">void</span> *arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      Job *job = <span class="literal">nullptr</span>;</span><br><span class="line">      pthread_mutex_lock (&amp;job_queue_mutex);</span><br><span class="line">      <span class="keyword">if</span> (!job_queue.empty ())</span><br><span class="line">        &#123;</span><br><span class="line">          job = job_queue.front ();</span><br><span class="line">          job_queue.pop_front ();</span><br><span class="line">        &#125;</span><br><span class="line">      pthread_mutex_unlock (&amp;job_queue_mutex);</span><br><span class="line">      <span class="keyword">if</span> (!job)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      ProcessJob (job);</span><br><span class="line">      <span class="keyword">delete</span> job, job = <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">EnqueueJob</span> <span class="params">(<span class="keyword">void</span> *arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  Job *job = <span class="keyword">reinterpret_cast</span>&lt;Job *&gt;(arg);</span><br><span class="line">  pthread_mutex_lock (&amp;job_queue_mutex);</span><br><span class="line">  job_queue.push_back (job);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">"Thread "</span> &lt;&lt; (<span class="keyword">int</span>) pthread_self ();</span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="string">" enqueueing ("</span> &lt;&lt; job-&gt;x &lt;&lt; <span class="string">","</span> &lt;&lt; job-&gt;y &lt;&lt; <span class="string">")\n"</span>;</span><br><span class="line"></span><br><span class="line">  pthread_mutex_unlock (&amp;job_queue_mutex);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">pthread_t</span> threads[<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">      Job *job = <span class="keyword">new</span> Job (i + <span class="number">1</span>, i + <span class="number">2</span>);</span><br><span class="line">      pthread_create (&amp;threads[i], <span class="literal">nullptr</span>, EnqueueJob, job);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">5</span>; i &lt; <span class="number">8</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">      pthread_create (&amp;threads[i], <span class="literal">nullptr</span>, DequeueJob, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">      pthread_join (threads[i], <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://songwei163.github.io/2019/06/08/线程管理（四）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宋伟">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古渡廊桥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/08/线程管理（四）/" class="post-title-link" itemprop="url">线程管理（四）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-06-08 23:52:12 / Geändert am: 23:52:52" itemprop="dateCreated datePublished" datetime="2019-06-08T23:52:12+08:00">2019-06-08</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="线程局部存储、线程清除"><a href="#线程局部存储、线程清除" class="headerlink" title="线程局部存储、线程清除"></a>线程局部存储、线程清除</h4><h5 id="线程局部存储"><a href="#线程局部存储" class="headerlink" title="线程局部存储"></a>线程局部存储</h5><h6 id="每个线程独有的数据"><a href="#每个线程独有的数据" class="headerlink" title="每个线程独有的数据"></a>每个线程独有的数据</h6><ul>
<li>线程特定数据</li>
<li>进程的多个线程通过全局堆共享全局数据对象</li>
<li>每个线程拥有独立的栈</li>
</ul>
<h6 id="让线程拥有数据的独立副本：不能简单赋值或读取"><a href="#让线程拥有数据的独立副本：不能简单赋值或读取" class="headerlink" title="让线程拥有数据的独立副本：不能简单赋值或读取"></a>让线程拥有数据的独立副本：不能简单赋值或读取</h6><ul>
<li><p><code>pthread_key_create()</code>函数：为线程特定数据创建一个键</p>
<ul>
<li><p>原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">pthread_key_create</span><span class="params">(<span class="keyword">pthread_key_t</span>  *key,  <span class="keyword">void</span> (*destr_function)(<span class="keyword">void</span> *))</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数：第一个指向<code>pthread_key_t</code>类型变量的指针（每个线程都可以使用它访问自己的独立数据副本）；第二个参数为指向线程清除函数的指针，如果不存在，传递<code>NULL</code>。</p>
</li>
</ul>
</li>
<li><p><code>pthread_serspecific()</code>函数：设置对应键的值</p>
</li>
<li><p><code>pthread_getspecific()</code>函数：读取对应键的值</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">pthread_key_t</span> tlk;<span class="comment">//关联线程日志文件指针的键</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">WriteToThreadLog</span> <span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  FILE *fp = (FILE *) pthread_getspecific (tlk);</span><br><span class="line">  <span class="built_in">fprintf</span> (fp, <span class="string">"%d:%s\n"</span>, (<span class="keyword">int</span>) pthread_self (), msg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CloseThreadLog</span> <span class="params">(<span class="keyword">void</span> *fp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  fclose ((FILE *) fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">ThreadFunc</span> <span class="params">(<span class="keyword">void</span> *args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> filename[<span class="number">255</span>];</span><br><span class="line">  FILE *fp;</span><br><span class="line">  <span class="comment">//生成与线程ID配套的日志文件名</span></span><br><span class="line">  <span class="built_in">sprintf</span> (filename, <span class="string">"thread%d.log"</span>, (<span class="keyword">int</span>) pthread_self ());</span><br><span class="line">  fp = fopen (filename, <span class="string">"w"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//设置线程日志文件指针与键的局部存储关联</span></span><br><span class="line">  pthread_setspecific (tlk, fp);</span><br><span class="line">  <span class="comment">//向日志中写入数据，不同的线程会写入不同的文件</span></span><br><span class="line">  WriteToThreadLog (<span class="string">"Thread starting..."</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">pthread_t</span> threads[<span class="number">8</span>];</span><br><span class="line">  <span class="comment">//创建键，使用CloseThreadLog()函数作为其清除程序</span></span><br><span class="line">  pthread_key_create (&amp;tlk,CloseThreadLog);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">      pthread_create (&amp;threads[i], <span class="literal">nullptr</span>, ThreadFunc, <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">      pthread_join (threads[i], <span class="literal">nullptr</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  pthread_key_delete (tlk);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="线程清除函数"><a href="#线程清除函数" class="headerlink" title="线程清除函数"></a>线程清除函数</h5><p>线程清除函数：回调函数，单void*参数，无返回值</p>
<ul>
<li>目的：销毁线程退出或被撤销时未释放的资源</li>
</ul>
<p><code>pthread_cleanup_push()</code>函数：注册线程清除函数</p>
<ul>
<li><p>原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pthread_cleanup_push</span><span class="params">(<span class="keyword">void</span> (*routine)(<span class="keyword">void</span> *),<span class="keyword">void</span> *arg)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数：<code>routine</code>为指向线程清除函数的函数指针，<code>arg</code>为传递给回调函数的附加数据对象</p>
</li>
</ul>
<p><code>pthread_cleanup_pop()</code>函数：取消线程清除函数注册</p>
<ul>
<li><p>原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pthread_cleanup_pop</span><span class="params">(<span class="keyword">int</span> execute)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数：整型值，非0调用回调函数释放资源，0不释放</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">AllocateBuffer</span> <span class="params">(<span class="keyword">size_t</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">malloc</span> (size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DeallocBuffer</span> <span class="params">(<span class="keyword">void</span> *buffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">free</span> (buffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DoSomeWork</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> *temp_buffer = AllocateBuffer (<span class="number">1024</span>);</span><br><span class="line">  <span class="comment">//注册清除处理函数</span></span><br><span class="line">  pthread_cleanup_push (DeallocBuffer, temp_buffer);</span><br><span class="line">      <span class="comment">//此处可以调用pthread_exit()退出线程或者撤销线程</span></span><br><span class="line">      <span class="comment">//取消线程，传递非0值，实施清除任务</span></span><br><span class="line">  pthread_cleanup_pop (<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="C-的问题"><a href="#C-的问题" class="headerlink" title="C++的问题"></a>C++的问题</h6><ul>
<li>对象的析构函数在线程退出时可能没有机会调用，因而线程栈上的数据未清除</li>
<li>如何确保线程资源被正确释放</li>
</ul>
<p>解决方法</p>
<ul>
<li>定义异常类，线程在准备退出时引发异常，然后在异常处理中退出线程执行</li>
<li>引发异常时，C++确保析构函数被调用</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EThreadExit</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  EThreadExit (<span class="keyword">void</span> *ret_val)</span><br><span class="line">      : _thread_ret_val (ret_val)</span><br><span class="line">  &#123; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> *<span class="title">DoThreadExit</span> <span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    pthread_exit (_thread_ret_val);</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">void</span> *_thread_ret_val;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">ThreadFunc</span> <span class="params">(<span class="keyword">void</span> *arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="comment">/*线程需要立即退出*/</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">throw</span> EThreadExit (<span class="comment">/*线程返回值*/</span>);	<span class="comment">/*异常处理对象*/</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">catch</span> (<span class="keyword">const</span> EThreadExit&amp; e)	<span class="comment">/*接收其传递*/</span></span><br><span class="line">    &#123;</span><br><span class="line">      e.DoThreadExit ();  <span class="comment">//执行线程实际退出动作	</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://songwei163.github.io/2019/06/08/线程管理（三）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宋伟">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古渡廊桥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/08/线程管理（三）/" class="post-title-link" itemprop="url">线程管理（三）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-06-08 23:51:32 / Geändert am: 23:51:57" itemprop="dateCreated datePublished" datetime="2019-06-08T23:51:32+08:00">2019-06-08</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="线程ID、线程属性、线程撤销"><a href="#线程ID、线程属性、线程撤销" class="headerlink" title="线程ID、线程属性、线程撤销"></a>线程ID、线程属性、线程撤销</h4><h5 id="线程ID"><a href="#线程ID" class="headerlink" title="线程ID"></a>线程ID</h5><p><code>pthread_equal()</code>函数：确认两个线程是否相同</p>
<ul>
<li>原型</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_equal</span><span class="params">(<span class="keyword">pthread_t</span> t1, <span class="keyword">pthread_t</span> t2)</span></span>;</span><br></pre></td></tr></table></figure>

<p><code>pthread_self()</code>函数：返回当前线程ID</p>
<ul>
<li>原型：</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pthread_t</span> pthread_self(<span class="keyword">void</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>示例</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!pthread_equal (pthread_self (), other_tid))</span><br><span class="line">  &#123;</span><br><span class="line">    pthread_join (other_tid, <span class="literal">nullptr</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h5 id="线程属性"><a href="#线程属性" class="headerlink" title="线程属性"></a>线程属性</h5><p>精细调整线程的行为</p>
<p>设置线程属性的流程</p>
<ul>
<li><p>创建<code>pthread_attr_t</code>类型的对象</p>
</li>
<li><p>调用<code>pthread_attr_init()</code>函数初始化线程缺省属性，传递指向该线程属性对象的指针</p>
<p>原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_attr_init</span><span class="params">(<span class="keyword">pthread_attr_t</span> *attr)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>对线程属性进行必要修改</p>
</li>
<li><p>调用<code>pthread_crerate()</code>函数时传递指向线程属性对象的指针</p>
</li>
<li><p>调用<code>pthread_attr_destroy()</code>函数清除线程属性对象，<code>pthread_attr_t</code>对象本身并没有被销毁，因而可以调用<code>pthread_attr_init()</code>函数再次初始化</p>
<p>​    原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_attr_destroy</span><span class="params">(<span class="keyword">pthread_attr_t</span> *attr)</span></span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>线程属性说明</p>
<ul>
<li>单一线程属性对象可以用于创建多个线程</li>
<li>线程创建后，继续保留线程属性对象本身并没有意义</li>
<li>对于大多数Linux程序，线程最重要的属性为分离状态（<code>detach state</code>）</li>
</ul>
<p>线程分类</p>
<ul>
<li><p>可联线程（<code>joinable thread</code>）:    缺省设置，终止时并不自动清除（类似僵尸进程），主线程必须调用<code>pthread_join()</code>获取其返回值，此后才能清除</p>
</li>
<li><p>分离线程（<code>detached thread</code>）：结束时自动清除，不能调用<code>pthread_join()</code>进行线程同步</p>
</li>
<li><p>可联线程可通过<code>pthread_detach()</code>函数分离，分离线程不能再次联结</p>
<p>​    原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_detach</span><span class="params">(<span class="keyword">pthread_t</span> thread)</span></span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><code>pthread_attr_setdeatchstate()</code>函数：设置线程分离属性</p>
<ul>
<li><p>原型</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_attr_setdetachstate</span><span class="params">(<span class="keyword">pthread_attr_t</span> *attr, <span class="keyword">int</span> detachstate)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>传递线程属性对象指针和分离线程设置参数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PTHREAD_CREATE_DETACHED</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><code>pthread_attr_getdetachstate()</code>函数：获取线程分离属性</p>
<ul>
<li><p>原型</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_attr_getdetachstate</span><span class="params">(<span class="keyword">const</span> <span class="keyword">pthread_attr_t</span> *attr, <span class="keyword">int</span> *detachstate)</span></span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">ThreadFunc</span> <span class="params">(<span class="keyword">void</span> *arg)</span></span></span><br><span class="line"><span class="function"></span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">pthread_attr_t</span> attr;</span><br><span class="line">  <span class="keyword">pthread_t</span> thread;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//初始化线程属性</span></span><br><span class="line">  pthread_attr_init (&amp;attr);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//设置线程属性的分离状态</span></span><br><span class="line">  pthread_attr_setdetachstate (&amp;attr, PTHREAD_CREATE_DETACHED);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//创建线程</span></span><br><span class="line">  pthread_create (&amp;thread, &amp;attr, &amp;ThreadFunc, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//清除线程属性对象</span></span><br><span class="line">  pthread_attr_destroy (&amp;attr);</span><br><span class="line">  <span class="comment">//无需联结该线程</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="线程撤销"><a href="#线程撤销" class="headerlink" title="线程撤销"></a>线程撤销</h5><p><code>pthread_cancel()</code>函数：撤销线程</p>
<ul>
<li><p>原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_cancel</span><span class="params">(<span class="keyword">pthread_t</span> thread)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>已撤销的线程可以来联结，且必须联结欸，以释放其资源，除非其为分离线程</p>
</li>
</ul>
<p>线程撤销类型与状态</p>
<ul>
<li>异步可撤销：在其执行的任何时刻都可撤销</li>
<li>同步可撤销：线程可撤销，但撤销操作首先进入队列排队，在线程执行到特定撤销点时才可撤销</li>
<li>不可撤销：撤销不可撤销线程的企图被系统忽略，且没有任何消息反馈</li>
</ul>
<p><code>pthread_setcanceltype()</code>函数：设置线程的撤销类型</p>
<ul>
<li><p>原型</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_setcanceltype</span><span class="params">(<span class="keyword">int</span> type, <span class="keyword">int</span> *oldtype)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数：</p>
<p><code>type</code>为撤销类型，<code>oldtype</code>用于保存原始线程撤销类型，<code>NULL</code>表示不保存</p>
</li>
<li><p><code>PTHREAD_CANCEL_ASYNCHRONOUS</code>：线程异步可撤销</p>
</li>
<li><p><code>PTHREAD_CANCEL_DEFERRED</code>：线程同步可撤销，即延迟到下一撤销点时撤销</p>
<p><code>pthread_setcanceltype()</code>函数：设置线程的撤销状态</p>
</li>
<li><p>原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_setcanceltype</span><span class="params">(<span class="keyword">int</span> type, <span class="keyword">int</span> *oldtype)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第一个参数<code>state</code>为可撤销状态，第二个参数<code>oldstate</code>用于保存原始线程的可撤销状态,<code>NULL</code>表示不保存</p>
</li>
<li><p><code>PTHREAD_CANCEL_ENABLE</code>：线程可撤销</p>
</li>
<li><p><code>PTHREAD_CANCEL_DISABLE</code>：线程不可撤销</p>
</li>
<li><p>线程的撤销状态可多次设置</p>
</li>
</ul>
<p><code>pthread_testcancel()</code>函数：设置撤销点</p>
<ul>
<li><p>原型</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pthread_testcancel</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在线程函数中调用<code>pthread_testcancel()</code>函数设置撤销点</p>
</li>
<li><p>建议：周期性地设置撤销点，保证线程函数内部每隔一些代码就有一个撤销点，以保证资源能够正确释放</p>
</li>
</ul>
<p>使用撤销状态构造临界区（critical section）</p>
<ul>
<li>临界区：要么全部执行，要么一条都不会执行的代码段</li>
<li>设置线程的撤销状态，线程一旦进入临界区，就必须等到离开临界区，才可以被撤销</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Transfer</span> <span class="params">(<span class="keyword">double</span> *accounts, <span class="keyword">int</span> from, <span class="keyword">int</span> to, <span class="keyword">double</span> amount)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> ocs;</span><br><span class="line">  <span class="comment">//数据有效性检查代码在此，确保转账操作合法有效</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//将线程设置为不可撤销的，进入临界区</span></span><br><span class="line">  pthread_setcancelstate (PTHREAD_CANCEL_DISABLE, &amp;ocs);</span><br><span class="line"></span><br><span class="line">  accounts[to] += amount;</span><br><span class="line">  accounts[from] -= accounts;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//恢复线程的撤销状态，离开临界区</span></span><br><span class="line">  pthread_setcancelstate (os, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://songwei163.github.io/2019/06/08/线程管理（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宋伟">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古渡廊桥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/08/线程管理（二）/" class="post-title-link" itemprop="url">线程管理（二）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-06-08 23:50:39 / Geändert am: 23:51:17" itemprop="dateCreated datePublished" datetime="2019-06-08T23:50:39+08:00">2019-06-08</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="线程函数参数与返回值"><a href="#线程函数参数与返回值" class="headerlink" title="线程函数参数与返回值"></a>线程函数参数与返回值</h4><h5 id="线程函数参数"><a href="#线程函数参数" class="headerlink" title="线程函数参数"></a>线程函数参数</h5><p>//注意本程序运行大部分情况下不会输出任何结果</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InfoPrinted</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  InfoPrinted (<span class="keyword">char</span> c, <span class="keyword">int</span> n)</span><br><span class="line">      : _c (c), _n (n)</span><br><span class="line">  &#123; &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Show</span> <span class="params">()</span> <span class="keyword">const</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; _n; ++i)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">cerr</span> &lt;&lt; _c;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">char</span> _c;</span><br><span class="line">  <span class="keyword">int</span> _n;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">PrintInfo</span> <span class="params">(<span class="keyword">void</span> *info)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  InfoPrinted *p = <span class="keyword">reinterpret_cast</span>&lt;InfoPrinted *&gt;(info);</span><br><span class="line">  <span class="keyword">if</span> (p != <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      p-&gt;Show ();</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">pthread_t</span> tid1, tid2;</span><br><span class="line"></span><br><span class="line">  InfoPrinted *p = <span class="keyword">new</span> InfoPrinted (<span class="string">'a'</span>, <span class="number">100</span>);</span><br><span class="line">  pthread_create (&amp;tid1, <span class="literal">nullptr</span>, &amp;PrintInfo, <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(p));</span><br><span class="line"></span><br><span class="line">  InfoPrinted *q = <span class="keyword">new</span> InfoPrinted (<span class="string">'z'</span>, <span class="number">100</span>);</span><br><span class="line">  pthread_create (&amp;tid2, <span class="literal">nullptr</span>, &amp;PrintInfo, <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(q));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//使用本注释行，可能仅有部分输出</span></span><br><span class="line">  <span class="comment">//PrintInfo (  reinterpret_cast&lt; void *&gt;(q));</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>存在的问题：一般不会产生任何输出</p>
<ul>
<li>子线程需要使用主线程的数据，如果主线程结束，子线程如何访问这些数据？</li>
</ul>
<p>解决方案：使用<code>pthread_join</code>函数，等待子线程结束</p>
<ul>
<li><p>原型：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_join</span><span class="params">(<span class="keyword">pthread_t</span> thread, <span class="keyword">void</span> **retval)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>参数：</p>
<p>thread为<code>pthread_t</code>类型的线程ID,<code>retval</code>接收线程返回值，不需要接收返回值时传递<code>NULL</code></p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">pthread_t</span> tid1, tid2;</span><br><span class="line"></span><br><span class="line">  InfoPrinted *p = <span class="keyword">new</span> InfoPrinted (<span class="string">'a'</span>, <span class="number">100</span>);</span><br><span class="line">  pthread_create (&amp;tid1, <span class="literal">nullptr</span>, &amp;PrintInfo, <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(p));</span><br><span class="line"></span><br><span class="line">  InfoPrinted *q = <span class="keyword">new</span> InfoPrinted (<span class="string">'z'</span>, <span class="number">100</span>);</span><br><span class="line">  pthread_create (&amp;tid2, <span class="literal">nullptr</span>, &amp;PrintInfo, <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(q));</span><br><span class="line"></span><br><span class="line">  pthread_join (tid1, <span class="literal">nullptr</span>);</span><br><span class="line">  pthread_join (tid2, <span class="literal">nullptr</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="线程函数返回值"><a href="#线程函数返回值" class="headerlink" title="线程函数返回值"></a>线程函数返回值</h5><p>//编译时添加<code>-fpermissive</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">IsPrime</span> <span class="params">(<span class="keyword">void</span> *n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> p = <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">unsigned</span> <span class="keyword">int</span>&gt;(n);</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">3u</span>, t = (<span class="keyword">unsigned</span> <span class="keyword">int</span>) <span class="built_in">sqrt</span> (p) + <span class="number">1u</span>;</span><br><span class="line">  <span class="keyword">if</span> (p == <span class="number">2u</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (p % <span class="number">2u</span> == <span class="number">0u</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (i &lt;= t)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (p % i == <span class="number">0u</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      i += <span class="number">2u</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">pthread_t</span> tids[<span class="number">8</span>];</span><br><span class="line">  <span class="keyword">bool</span> primalities[<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">      pthread_create (&amp;tids[i], <span class="literal">nullptr</span>, &amp;IsPrime, <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> *&gt;(i + <span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">      pthread_join (tids[i], <span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">void</span> **&gt;(&amp;primalities[i]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">cout</span> &lt;&lt; primalities[i] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://songwei163.github.io/2019/06/08/线程管理（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宋伟">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古渡廊桥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/08/线程管理（一）/" class="post-title-link" itemprop="url">线程管理（一）</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-06-08 23:49:08 / Geändert am: 23:49:44" itemprop="dateCreated datePublished" datetime="2019-06-08T23:49:08+08:00">2019-06-08</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="线程管理"><a href="#线程管理" class="headerlink" title="线程管理"></a>线程管理</h4><ul>
<li>线程创建</li>
<li>线程函数参数与返回值</li>
<li>线程ID</li>
<li>线程属性</li>
<li>线程撤销</li>
<li>线程局部存储</li>
<li>线程清除</li>
</ul>
<h5 id="线程创建函数"><a href="#线程创建函数" class="headerlink" title="线程创建函数"></a>线程创建函数</h5><ul>
<li><p>头文件：<code>&lt;pthread.h&gt;</code></p>
</li>
<li><p>原型：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pthread_create</span><span class="params">(<span class="keyword">pthread_t</span> *thread, <span class="keyword">const</span> <span class="keyword">pthread_attr_t</span> *attr,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">void</span> *(*start_routine) (<span class="keyword">void</span> *), <span class="keyword">void</span> *arg)</span></span>;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="线程创建流程"><a href="#线程创建流程" class="headerlink" title="线程创建流程"></a>线程创建流程</h5><ul>
<li><p>定义指向<code>pthread_t</code>对象的指针对象，<code>pthread_t</code>对象用于存储新线程的ID</p>
</li>
<li><p>定义指向线程属性<code>pthread_attr_t</code>对象的指针对象；线程属性对象控制线程与程序其他部分（可能是其他线程的交互）；如果传递NULL，则使用缺省属性构造新线程</p>
</li>
<li><p>定义指向线程函数的指针对象，使其指向固定格式的线程函数</p>
</li>
<li><p>实现线程函数；线程函数的参数和返回值均为哑型指针；需要传递多个参数时，打包成单个<code>void*</code>的指针对象</p>
</li>
<li><p>线程退出时使用返回值将数据传递给主调线程；多个结果同样可以打包传递</p>
</li>
</ul>
<h5 id="线程创建说明"><a href="#线程创建说明" class="headerlink" title="线程创建说明"></a>线程创建说明</h5><ul>
<li><code>pthread_create()</code>函数在线程创建完毕后 立即返回，它并不等待线程结束</li>
<li>原线程与新线程如何执行与调度有关，程序不得依赖线程先后执行的关系</li>
<li>可以使用同步机制确定线程的先后执行关系</li>
</ul>
<h5 id="线程退出方式"><a href="#线程退出方式" class="headerlink" title="线程退出方式"></a>线程退出方式</h5><ul>
<li>线程函数结束执行</li>
<li>调用<code>pthread_exit()</code>函数显式结束</li>
<li>被其他线程撤销</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">PrintAs</span> <span class="params">(<span class="keyword">void</span> *unused)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">cerr</span> &lt;&lt; <span class="string">'a'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">PrintZs</span> <span class="params">(<span class="keyword">void</span> *unused)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">cerr</span> &lt;&lt; <span class="string">'z'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">pthread_t</span> thread_id;</span><br><span class="line">  pthread_create (&amp;thread_id, <span class="literal">nullptr</span>, &amp;PrintAs, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">  PrintZs (<span class="literal">nullptr</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://songwei163.github.io/2019/06/08/线程基本概念/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宋伟">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古渡廊桥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/08/线程基本概念/" class="post-title-link" itemprop="url">线程基本概念</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-06-08 23:47:53 / Geändert am: 23:48:48" itemprop="dateCreated datePublished" datetime="2019-06-08T23:47:53+08:00">2019-06-08</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="线程基本概念"><a href="#线程基本概念" class="headerlink" title="线程基本概念"></a>线程基本概念</h4><h5 id="线程的定义"><a href="#线程的定义" class="headerlink" title="线程的定义"></a>线程的定义</h5><ul>
<li>线程是比进程更小的程序执行单位</li>
<li>多个线程可以共享全局数据，也可以使用专有数据</li>
</ul>
<h5 id="Linux线程支持史"><a href="#Linux线程支持史" class="headerlink" title="Linux线程支持史"></a>Linux线程支持史</h5><ul>
<li>1996年，LinuxThreads：基本符合POSIX标准，但效率低下，问题多多</li>
<li>2003年，内核2.6：提供线程支持库NPTL（Native POSIX Thread Library for Linux）</li>
</ul>
<h5 id="内核线程"><a href="#内核线程" class="headerlink" title="内核线程"></a>内核线程</h5><ul>
<li>操作系统内核支持多线程调度与执行</li>
<li>内核线程使用资源较少，仅包括内核栈和上下文切换时需要的保存寄存器内容的空间</li>
</ul>
<h5 id="轻量级线程（lightweight-process，LWP）"><a href="#轻量级线程（lightweight-process，LWP）" class="headerlink" title="轻量级线程（lightweight process，LWP）"></a>轻量级线程（lightweight process，LWP）</h5><ul>
<li>由内核支持的独立调度单元，调度开销小于普通的进程</li>
<li>系统支持多个轻量级进程同时运行，每个都与特定的内核线程相关联</li>
</ul>
<h5 id="用户线程"><a href="#用户线程" class="headerlink" title="用户线程"></a>用户线程</h5><ul>
<li>建立在用户空间的多个用户级线程，映射到轻量级进程侯调度执行</li>
<li>用户线程在用户空间创建、同步和销毁，开销较低</li>
<li>每个线程具有独特的ID</li>
</ul>
<h5 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h5><ul>
<li>线程功能不属于C/C++标准库，链接时需用<code>-pthread</code>选项</li>
<li>线程功能属于C++11标准库 ，可用C++11提供的<code>thread</code>类定义线程对象，C++11标准库同时提供基本的线程同步机制</li>
</ul>
<h5 id="进程与线程的比较"><a href="#进程与线程的比较" class="headerlink" title="进程与线程的比较"></a>进程与线程的比较</h5><ul>
<li>线程空间不独立，有问题的线程会影响其他线程；进程空间独立，有问题的进程一般不会影响其他进程</li>
<li>创建进程需要额外的性能开销</li>
<li>线程用于开发细颗粒度并行性，就能成用于开发粗颗粒度并行性</li>
<li>线程容易共享数据，进程共享数据必须使用进程间通信机制（IPC ）</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://songwei163.github.io/2019/06/08/线程提纲/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宋伟">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古渡廊桥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/08/线程提纲/" class="post-title-link" itemprop="url">线程提纲</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-06-08 23:44:45 / Geändert am: 23:46:26" itemprop="dateCreated datePublished" datetime="2019-06-08T23:44:45+08:00">2019-06-08</time>
            

            
              

              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">in</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="线程基本概念"><a href="#线程基本概念" class="headerlink" title="线程基本概念"></a>线程基本概念</h4><h4 id="线程管理"><a href="#线程管理" class="headerlink" title="线程管理"></a>线程管理</h4><ul>
<li>线程创建</li>
<li>线程撤销</li>
<li>线程属性</li>
<li>线程局部存储</li>
<li>线程清除</li>
</ul>
<h4 id="线程同步机制"><a href="#线程同步机制" class="headerlink" title="线程同步机制"></a>线程同步机制</h4><ul>
<li>互斥</li>
<li>死锁</li>
<li>信号量</li>
<li>条件变量</li>
</ul>
<h4 id="C-11线程库"><a href="#C-11线程库" class="headerlink" title="C++11线程库"></a>C++11线程库</h4>
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://songwei163.github.io/2019/06/08/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="宋伟">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="古渡廊桥">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/08/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              

              
                
              

              <time title="Erstellt: 2019-06-08 22:59:45" itemprop="dateCreated datePublished" datetime="2019-06-08T22:59:45+08:00">2019-06-08</time>
            

            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">宋伟</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">Artikel</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">Kategorien</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">schlagwörter</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/songwei163" title="GitHub &rarr; https://github.com/songwei163" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:songweicpp@163.com" title="E-Mail &rarr; mailto:songweicpp@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">宋伟</span>

  

  
</div>


  <div class="powered-by">Erstellt mit  <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Design – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.1.2</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.2"></script>

  <script src="/js/motion.js?v=7.1.2"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.1.2"></script>



  

  


  <script src="/js/next-boot.js?v=7.1.2"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
